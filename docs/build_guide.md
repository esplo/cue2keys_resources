# ビルドガイド

このページは、[くっつきー](https://cue2keys.esplo.net/)のビルドガイドです。
質問や要望は[issue](https://github.com/esplo/cue2keys_resources/issues)にお寄せください。

## 概要

![ロゴ](../img/logo.png)

くっつきーは、フルモジュラー方式のキーボードです。
キー、トラックボール、ロータリーエンコーダーなどのモジュールを自由に接続し、お好みの機能を持ったキーボードを構成できます。

詳細は[公式サイト](https://cue2keys.esplo.net/)をご覧ください。

## 用意するもの

- クリップなどの細いピン
  - 本体のスイッチを押すために使います
- Cherry MX互換のキーキャップ
  - 構成に合わせた数を用意します
  - キーモジュールが横向きになる場合は、キースイッチとキーキャップの相性が問題ないか事前に確認してください
- （あると嬉しい）パームレスト

## 組み立て手順

※ スターターセットなど構成済みセットを購入された方は、手順6から開始できます。まずは[セットガイド](./set_guide.md)をご覧ください。

### 1. 作りたいキーボードを考える

[公式サイト](https://cue2keys.esplo.net/)の構成例などを参考に、自分が理想とするキーボードの構成を考えましょう。

### 2. 必要なモジュールを揃える / 購入ガイド

モジュールは[BOOTH](https://c2k.booth.pm)やイベントで販売しています。
考えた構成に必要なモジュールを揃えましょう。

ただし、モジュールごとに制限がありますので、購入前に確認してください。
不明な点は[issue](https://github.com/esplo/cue2keys_resources/issues)や[SNS](https://linktr.ee/cue2keys)でお問い合わせください。

現時点での接続方式や制限は以下の通りです：

![モジュール接続解説画像](../img/module_connection.png)

- PCと接続するモジュールである「ペンダント」は、必ず1つ必要です
- ペンダントは4つのチャンネル（接続口）を持っています
- 使用する1チャンネルにつき1つのハブが必要です（そのチャンネルに何も接続しない場合は接続不要）
- 4キーと5キーモジュールは、1チャンネルにつき合計で8つまで接続できます
  - 8つ以上接続する場合は、他のチャンネルに分散させてください
- ロータリーエンコーダーは1チャンネルにつき4つまで接続できます
- トラックボールは特殊なモジュールです。最大2台まで接続可能でハブは不要です

スターターセットを例に見てみましょう：

![スターターセットの画像](../img/c_60_1.png)

スターターセットは左右分割、66キーのキーボードです。
左手部分は5キーモジュールが5つ、4キーモジュールが2つで構成されており、ハブ経由でチャンネル1に接続しています。
キーモジュールは合計で7つなので、上限の8個を超えていません。
右手も同様の構成で、こちらはチャンネル2に接続しています。

### 3. 配置を考える

土台に各モジュールを仮置きして、配置を決めます。
この段階ではまだしっかりと固定せず、簡単に取り外せる状態にしておきましょう。

キーの配置だけでなく、トラックボールやロータリーエンコーダーをどこに配置するか、傾斜をどうするかも考慮します。
スターターセットでは、ハブは土台の下に置き、ハブと土台の間に10°チップを設置するのが標準的な方法です。

なお、ロウスタッガード（行をずらした配列）の場合は、キースイッチが横向きになるためキーキャップがはまりにくい場合があります。キースイッチとキーキャップの互換性を事前に確認してください。

配置が決まったら、次はモジュールの設定を行います。

### 4. モジュールのアドレス設定

キーモジュールとロータリーエンコーダーは、ディップスイッチでアドレスを指定する必要があります。
この設定は**キーマップと連動**するため、スターターキットなど既定のキーマップがある場合は特定の設定にする必要があります。

![key4の背面](../img/key4_back.png)

![DIPスイッチ対応表](../img/dip.png)

同じチャンネル内では、同一タイプのモジュールに**重複したアドレスを設定しないでください**。
キーモジュールとロータリーエンコーダーは独立しているため、同じ設定でも問題ありません。
分かりやすくするために、左側から0, 1, 2...と順番に設定するのがおすすめです。

- キーモジュール
  - 3つのスイッチがあり、8通り（0〜7）の設定ができます
- ノブ（ロータリーエンコーダー）
  - 2つのスイッチがあり、4通り（0〜3）の設定ができます
  - 3つ目のスイッチはケースで隠れていますが、必ずOFF状態にしておく必要があります。もしONになっている場合は、OFFに変更してください

### 5. 接続する

設定が完了したら、ケーブルで各モジュールを接続します。
モジュールによって異なるケーブルと接続先がありますので、以下を参考にしてください。

![モジュール接続解説画像](../img/module_connection.png)

- キーモジュール・ロータリーエンコーダー
  - ハブに接続します（4本線のHYケーブルを使用）
  - ハブには左右に各5個、計10個のソケットがありますので、好きな場所に接続できます
  - キーモジュールとロータリーエンコーダーの合計が10個を超える場合、1つのハブでは足りません。ハブを連結することも可能ですが、別のチャンネルのハブに分散することをおすすめします
- トラックボール
  - ペンダントに直接接続します（6本線のZHケーブルを使用）
  - 最大2個まで接続可能です
- ハブ
  - ペンダントに接続します（USB A-Cケーブルを使用）
  - ペンダントの下部にある4つのチャンネルのいずれかに接続します
  - 接続するチャンネルによってキーマップとの対応関係が変わります。通常はチャンネル1から使用することをおすすめします
  - 標準のケーブル長は1.5mですが、必要に応じて延長することも可能です（ただし、長すぎると誤動作の原因となる場合があります）

すべて接続できたら、最後にペンダントとPCを接続します。接続にはUSB C-AまたはC-Cケーブルが使用できます。ケーブルの長さが足りない場合は、延長ケーブルを使用することも可能です。

なお、接続に必要な各種ケーブルはモジュール購入時に付属しています。
長さなどを変更したい場合は、各モジュールの詳細ページに記載されているケーブル仕様を確認して、適切な代替品を探してください。

### 6. 接続の確認

PCと接続してキーを押すと、ペンダントのディスプレイに情報が表示されます。
表示されない場合は、ファームウェアが正常に書き込まれていない可能性があります。
その場合は[ファームウェアガイド](./firmware_guide.md)を参照して、ファームウェアを書き込んでください。
問題が解決しない場合は、接続の確認や他のモジュールを一時的に外して接続テストを行ったり、FAQを確認してください。

ディスプレイ（1ページ目）には、接続されているモジュールの種類と数が表示されます：

- `# Devices`: トラックボール以外の認識されているモジュール数
- `KEY4`: key4モジュールの認識数
- `KEY5`: key5モジュールの認識数
- `RE`: ロータリーエンコーダーモジュールの認識数
- `TB`: トラックボールモジュールの認識数

表示されている数が実際の接続数と異なる場合は、同一チャンネル内で重複したアドレスが設定されている可能性があります。
また、ケーブルがしっかり接続されているか、ケーブル自体に問題がないかも確認してください。

### 7. キーマップの設定

接続が正常に完了したら、次はキーマップを設定します。
詳細な手順については[キーマップガイド](./keymap_guide.md)を参照してください。

なお、レイヤー3は「マウスレイヤー」として設定されており、トラックボールを操作している間とその後しばらくの間だけ有効になるレイヤーです。
このレイヤーにマウスの左右クリックやスクロール機能を割り当てておくと便利です。

### 8. 調整する

実際に使用してみて、配置やキーマップを調整しましょう。
キーの配置を大きく変更する場合は、手順3からやり直すと良いでしょう。

トラックボールについては、ソフトウェア側で角度、速度、マウスレイヤーの設定など、様々な調整が可能です。
詳しくは[カスタムキーコード一覧](./custom_keycodes.md)を参照してください。
