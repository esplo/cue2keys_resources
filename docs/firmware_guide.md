# ファームウェアガイド

このページでは、ファームウェアに関する解説を行います。

キーボードとしての機能は、ペンダントモジュールに書き込まれたファームウェアが実現しています。
挙動を変更したいとき、動作に問題があるときは、ファームウェアを変更してみましょう。

## 現行ファームウェア

ビルド済みのファームウェアを用意しています。
上手くいかない場合は、こちらを書き込んでみましょう。

[ビルド済みファームウェア](../firmware/cue2keys_default.uf2)

コードは[esplo/cue2keys_firmwareのvia-enabledブランチ](https://github.com/esplo/cue2keys_firmware/tree/via-enabled)で公開しています。

### 主な機能

- QMK/VIAによるキーリマップ対応
- 8レイヤーに対応
  - 更に必要であれば増やせます
- ディスプレイへの情報表示
  - ペンダントのボタンを押すことでページが変わります

### トラックボール関連

- トラックボールの自動スリープ
  - デフォルトでは5分で消灯します。キーを押したり、ロータリーエンコーダーを触ると起動します
- トラックボールを動かしている間、マウスレイヤーが有効になる
  - デフォルトのキーマップでは、レイヤー3が有効になります。左右クリックなどが割り当てられています

### カスタムキーコード

- トラックボールの角度調整（`ROT_*`）
  - 2°単位での調整が可能
- トラックボールを止めてから何秒間マウスレイヤーを有効にし続けるかを調整（`ML`）
  - 100ms単位、0msから4000msまで設定可能

## ファームウェアの書き込み方法

ペンダントモジュールにファームウェアを書き込むには、ブートローダーを起動する必要があります。
この状態では、キーを入力しても反応しなくなるので注意しましょう。
状況に応じて、別のキーボードを繋いだり、ノートPCでの作業が必要です。

ブートローダーを起動するには、いくつかの方法があります。

- （おすすめ）ペンダントのRSTボタンをダブルクリックする
  - ゆっくりと二回押します。クリップなど、細いピンで押すことができます
- PCと接続しているケーブルを抜き、ペンダントのBSボタンを押しながら接続する
- `QK_BOOT`キーをマッピングしておき、それを押す
  - 頻繁に書き込む場合におすすめです

ブートローダーに入ると、PCからは外部ストレージとして認識されます。
そこにファームウェア（`.uf2`ファイル）を置くことで、書き込みが行われます。
完了すると、自動的に接続が解除され、再度認識されます。

書き込み後、うまく認識しない場合は、PCと接続しているケーブルを抜き差ししてリセットしてください。

## コードからビルドする

上記に記載の通り、必要なコードは全て公開されています。
既存のコードを元にして、好きな機能を追加してみましょう。

余白が足りないため、ここではQMKの解説は記載しません。
他のQMKファームウェアと同様の方法で開発を行ってください。
